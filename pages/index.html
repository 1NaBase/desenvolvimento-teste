<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth bg-white text-gray-900 font-inter">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard CRM - Virtuallure</title>
<meta name="description" content="Dashboard CRM para gerenciamento de leads e clientes da Virtuallure." />
<link href="https://fonts.googleapis.com/css2?family=Inter&family=Orbitron:wght@700&display=swap" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="css/style.css">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<style>
/* Estilos utilitários */
.lead-note { display: flex; align-items: flex-start; gap: 12px; padding: 12px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 12px; }
.lead-meta { flex: 1; }
.actions { display:flex; gap:8px; align-items:center; }
.lead-comments { margin-top:8px; padding-left: 18px; }
.btn-small { background:#f3f4f6; padding:6px 10px; border-radius:6px; font-size:14px; }
.btn-danger { background:#ef4444; color:white; padding:6px 10px; border-radius:6px; }
.btn-primary { background:#2563eb; color:white; padding:6px 10px; border-radius:6px; }
.status { font-weight:600; padding:4px 8px; border-radius:999px; font-size:13px; display:inline-block; }
.status-novo { background:#eef2ff; color:#3730a3; }
.status-contato { background:#fff7ed; color:#92400e; }
.status-proposta { background:#fef3c7; color:#78350f; }
.status-fechado { background:#ecfdf5; color:#065f46; }
.lead-select { transform: scale(1.1); }
</style>
</head>
<body class="flex flex-col min-h-screen bg-white text-gray-900">

<!-- Header -->
<header class="fixed top-0 left-0 w-full bg-[#1e293b] border-b border-[#334155] z-50 shadow">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-6 py-4">
    <a href="/" class="flex items-center space-x-2 select-none" aria-label="Virtuallure - Home">
      <svg class="w-10 h-10 neon-purple" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24" aria-hidden="true">
        <path d="M12 2L2 7l10 5 10-5-10-5z"></path>
        <path d="M2 17l10 5 10-5"></path>
        <path d="M2 12l10 5 10-5"></path>
      </svg>
      <span class="text-2xl font-orbitron font-bold neon-purple">Virtuallure</span>
    </a>
    <nav class="hidden md:block" aria-label="Menu principal">
      <ul class="flex space-x-8 font-semibold tracking-wide text-lg">
        <li><a href="https://virtuallure.com.br" class="neon-link" target="_blank">Home</a></li>
        <li><a href="#dashboard" class="neon-link">Dashboard</a></li>
        <li><a href="#leads" class="neon-link">Leads</a></li>
        <li><a href="#funil" class="neon-link">Funil</a></li>
      </ul>
    </nav>
    <button class="md:hidden text-white hover:text-purple-300 focus:outline-none focus:text-purple-300" aria-label="Abrir menu" aria-expanded="false" id="menu-toggle">
      <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>
  </div>
</header>

<main class="flex-grow pt-24 pb-12 max-w-7xl mx-auto px-6">

  <!-- Dashboard Header -->
  <section id="dashboard" class="mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
    <h1 class="text-3xl md:text-4xl font-orbitron font-bold neon-blue">Dashboard CRM</h1>
    <div class="flex space-x-4">
      <button id="btn-delete-selected" class="btn-neon btn-delete font-semibold rounded-lg px-6 py-3 shadow-lg focus:outline-none focus:ring-4 focus:ring-red-500/60">Excluir Selecionados</button>
      <button id="btn-export" class="btn-neon font-semibold rounded-lg px-6 py-3 shadow-lg focus:outline-none focus:ring-4 focus:ring-purple-500/60">Exportar Dados</button>
      <button id="btn-new-lead" class="bg-blue-600 hover:bg-blue-700 font-semibold rounded-lg px-6 py-3 shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-500/60 neon-blue text-white">Novo Lead</button>
    </div>
  </section>

  <!-- Stats Overview -->
  <section class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-10">
    <div class="stat-card"><div class="text-3xl font-bold neon-blue mb-2" id="leads-hoje">24</div><div>Leads Hoje</div></div>
    <div class="stat-card"><div class="text-3xl font-bold neon-purple mb-2" id="leads-semana">156</div><div>Leads Semana</div></div>
    <div class="stat-card"><div class="text-3xl font-bold text-yellow-500 mb-2" id="taxa-conversao">42%</div><div>Taxa Conversão</div></div>
    <div class="stat-card"><div class="text-3xl font-bold text-green-500 mb-2" id="fechamentos">18</div><div>Fechamentos</div></div>
  </section>

  <!-- Filter Section -->
  <section class="filter-section mb-10">
    <h2 class="text-xl font-semibold neon-purple mb-4">Filtrar Leads</h2>
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
      <div>
        <label class="block mb-2 text-gray-900">Status</label>
        <select id="filter-status" class="w-full rounded-md bg-white border border-gray-300 focus:border-purple-600 text-gray-900 px-3 py-2 outline-none">
          <option value="">Todos</option>
          <option value="novo">Novo</option>
          <option value="contato">Em Contato</option>
          <option value="proposta">Proposta Enviada</option>
          <option value="fechado">Fechado</option>
        </select>
      </div>
      <div>
        <label class="block mb-2 text-gray-900">Data Início</label>
        <input type="date" class="w-full rounded-md bg-white border border-gray-300 focus:border-purple-600 text-gray-900 px-3 py-2 outline-none" />
      </div>
      <div>
        <label class="block mb-2 text-gray-900">Data Fim</label>
        <input type="date" class="w-full rounded-md bg-white border border-gray-300 focus:border-purple-600 text-gray-900 px-3 py-2 outline-none" />
      </div>
      <div>
        <label class="block mb-2 text-gray-900">Buscar</label>
        <input id="filter-search" type="text" placeholder="Nome ou email..." class="w-full rounded-md bg-white border border-gray-300 focus:border-purple-600 text-gray-900 px-3 py-2 outline-none" />
      </div>
    </div>
    <div class="mt-4 flex justify-end">
      <button id="btn-apply-filters" class="btn-neon font-semibold rounded-lg px-6 py-2 shadow-lg focus:outline-none focus:ring-4 focus:ring-purple-500/60">Aplicar Filtros</button>
    </div>
  </section>

  <!-- Leads List -->
  <section id="leads" aria-label="Leads recentes" class="leads-list mb-8">
    <!-- Leads serão inseridos dinamicamente via JS -->
  </section>

  <!-- Pagination -->
  <section class="pagination" aria-label="Navegação de Leads">
    <button class="pagination-btn" disabled>Anterior</button>
    <span class="pagination-info">Página 1</span>
    <button class="pagination-btn">Próximo</button>
  </section>

</main>

<footer class="bg-[#1e293b] text-white text-center py-4 mt-auto">
  <p>&copy; 2025 Virtuallure. Todos os direitos reservados.</p>
</footer>

<!-- Modais -->
<!-- Modal Detalhes -->
<div id="modal-detalhes" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg w-96 shadow-xl max-h-[80vh] overflow-auto">
    <h2 class="text-xl font-bold mb-4">Detalhes do Lead</h2>
    <div id="detalhes-content" class="space-y-2"></div>
    <div class="mt-4">
      <h3 class="font-semibold">Comentários</h3>
      <ul id="detalhes-comments-list" class="lead-comments mt-2"></ul>
      <div class="mt-3 flex gap-2">
        <input id="new-comment-input" type="text" placeholder="Adicionar comentário..." class="w-full border px-3 py-2 rounded" />
        <button id="btn-add-comment" class="btn-primary">Adicionar</button>
      </div>
    </div>
    <div class="mt-4 flex justify-end gap-2">
      <button onclick="closeModal('modal-detalhes')" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded">Fechar</button>
    </div>
  </div>
</div>

<!-- Modal Editar -->
<div id="modal-editar" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white p-6 rounded-lg w-96 shadow-xl">
    <h2 class="text-xl font-bold mb-4">Editar Lead</h2>
    <form id="form-editar" class="space-y-3">
      <input type="text" id="edit-nome" class="w-full border px-3 py-2 rounded" placeholder="Nome" required>
      <input type="email" id="edit-email" class="w-full border px-3 py-2 rounded" placeholder="Email" required>
      <input type="text" id="edit-telefone" class="w-full border px-3 py-2 rounded" placeholder="Telefone">
      <textarea id="edit-msg" class="w-full border px-3 py-2 rounded" placeholder="Mensagem"></textarea>
      <select id="edit-status" class="w-full border px-3 py-2 rounded">
        <option value="novo">Novo</option>
        <option value="contato">Em Contato</option>
        <option value="proposta">Proposta Enviada</option>
        <option value="fechado">Fechado</option>
      </select>
      <div class="flex justify-end gap-2">
        <button type="button" onclick="closeModal('modal-editar')" class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded">Cancelar</button>
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Salvar</button>
      </div>
    </form>
  </div>
</div>

<script type="module" src="../js/dashboard.js"></script>
<script type="module">
/* dashboard.js - versão otimizada */

// =============== ELEMENTOS ===============
const leadsContainer = document.getElementById("leads");
const btnNewLead = document.getElementById("btn-new-lead");
const btnExport = document.getElementById("btn-export");
const btnDeleteSelected = document.getElementById("btn-delete-selected");
const filterStatus = document.getElementById("filter-status");
const filterSearch = document.getElementById("filter-search");
const btnApplyFilters = document.getElementById("btn-apply-filters");
const paginationInfo = document.querySelector(".pagination-info");
const paginationPrev = document.querySelector(".pagination-btn:first-child");
const paginationNext = document.querySelector(".pagination-btn:last-child");

const modalDetalhes = document.getElementById("modal-detalhes");
const detalhesContent = document.getElementById("detalhes-content");
const detalhesCommentsList = document.getElementById("detalhes-comments-list");
const newCommentInput = document.getElementById("new-comment-input");
const btnAddComment = document.getElementById("btn-add-comment");

const modalEditar = document.getElementById("modal-editar");
const formEditar = document.getElementById("form-editar");
const editNome = document.getElementById("edit-nome");
const editEmail = document.getElementById("edit-email");
const editTelefone = document.getElementById("edit-telefone");
const editMsg = document.getElementById("edit-msg");
const editStatus = document.getElementById("edit-status");

// =============== VARIÁVEIS GLOBAIS ===============
let leadsData = [];       // Todos os leads carregados
let currentLead = null;   // Lead atual para edição/detalhes
let currentPage = 1;      // Página atual
const leadsPerPage = 5;   // Leads por página

// =============== FUNÇÕES AUXILIARES ===============
function openModal(el) {
    if (typeof el === 'string') document.getElementById(el).classList.remove("hidden");
    else el.classList.remove("hidden");
}
function closeModal(el) {
    if (typeof el === 'string') document.getElementById(el).classList.add("hidden");
    else el.classList.add("hidden");
}

// Fecha modal ao clicar fora
[modalDetalhes, modalEditar].forEach(modal => {
    modal.addEventListener("click", e => { if(e.target === modal) closeModal(modal.id); });
});
// Fecha com ESC
document.addEventListener("keydown", e => {
    if(e.key === "Escape") { closeModal("modal-detalhes"); closeModal("modal-editar"); }
});

// =============== RENDERIZAÇÃO DE LEADS ===============
function renderLeads() {
    leadsContainer.innerHTML = "";
    const filtered = getFilteredLeads();
    const totalPages = Math.ceil(filtered.length / leadsPerPage);
    if(currentPage > totalPages) currentPage = totalPages || 1;

    const start = (currentPage - 1) * leadsPerPage;
    const end = start + leadsPerPage;
    const pageLeads = filtered.slice(start, end);

    pageLeads.forEach(lead => {
        const article = document.createElement("article");
        article.className = "lead-note";
        article.dataset.id = lead.id;
        article.innerHTML = `
            <input type="checkbox" class="lead-select" title="Selecionar lead">
            <div class="lead-meta">
                <h3>${lead.nome}</h3>
                <p><strong>Email:</strong> ${lead.email}</p>
                <p><strong>Telefone:</strong> ${lead.telefone}</p>
                <p class="message">${lead.mensagem}</p>
                <span class="status status-${lead.status}" data-status="${lead.status}">${statusText(lead.status)}</span>
                <ul class="lead-comments hidden">
                    ${lead.comments.map(c => `<li class="lead-comment">${c}</li>`).join("")}
                </ul>
            </div>
            <div class="actions">
                <button class="btn-small btn-edit">Editar</button>
                <button class="btn-small btn-detalhes">Detalhes</button>
                <button class="btn-small btn-delete">Excluir</button>
            </div>
        `;
        leadsContainer.appendChild(article);
        attachLeadEvents(article);
    });

    paginationInfo.textContent = `Página ${currentPage} de ${totalPages || 1}`;
    paginationPrev.disabled = currentPage === 1;
    paginationNext.disabled = currentPage === totalPages || totalPages === 0;
}

function statusText(status) {
    return { novo: "Novo", contato: "Em Contato", proposta: "Proposta Enviada", fechado: "Fechado" }[status] || status;
}

// =============== FILTROS ===============
function getFilteredLeads() {
    const status = filterStatus.value;
    const query = filterSearch.value.trim().toLowerCase();
    return leadsData.filter(lead => {
        const matchesStatus = !status || lead.status === status;
        const matchesQuery = !query || lead.nome.toLowerCase().includes(query) || lead.email.toLowerCase().includes(query);
        return matchesStatus && matchesQuery;
    });
}

filterStatus.addEventListener("change", () => { currentPage = 1; renderLeads(); });
filterSearch.addEventListener("input", () => { currentPage = 1; renderLeads(); });
btnApplyFilters.addEventListener("click", () => { currentPage = 1; renderLeads(); });

// =============== PAGINAÇÃO ===============
paginationPrev.addEventListener("click", () => { if(currentPage>1){ currentPage--; renderLeads(); }});
paginationNext.addEventListener("click", () => { currentPage++; renderLeads(); });

// =============== ANEXAR EVENTOS ===============
function attachLeadEvents(lead) {
    lead.querySelector(".btn-detalhes").addEventListener("click", () => openLeadDetails(lead));
    lead.querySelector(".btn-edit").addEventListener("click", () => openLeadEdit(lead));
    lead.querySelector(".btn-delete").addEventListener("click", () => {
        if(confirm("Deseja realmente excluir este lead?")){
            const id = parseInt(lead.dataset.id);
            leadsData = leadsData.filter(l => l.id !== id);
            renderLeads();
        }
    });
}

// =============== DETALHES ===============
function openLeadDetails(leadEl) {
    const id = parseInt(leadEl.dataset.id);
    currentLead = leadsData.find(l => l.id === id);
    const l = currentLead;

    detalhesContent.innerHTML = `
        <p><strong>Nome:</strong> ${l.nome}</p>
        <p><strong>Email:</strong> ${l.email}</p>
        <p><strong>Telefone:</strong> ${l.telefone}</p>
        <p><strong>Mensagem:</strong> ${l.mensagem}</p>
        <p><strong>Status:</strong> ${statusText(l.status)}</p>
    `;

    detalhesCommentsList.innerHTML = l.comments.length ? 
        l.comments.map(c => `<li>${c}</li>`).join("") : "<li class='text-sm text-gray-500'>Sem comentários</li>";

    newCommentInput.value = "";
    openModal(modalDetalhes);
    newCommentInput.focus();
}

// Adicionar comentário
btnAddComment.addEventListener("click", () => {
    if(!currentLead) return;
    const text = newCommentInput.value.trim();
    if(!text) return alert("Digite um comentário antes.");
    currentLead.comments.push(text);
    renderLeads();
    openLeadDetails(document.querySelector(`.lead-note[data-id="${currentLead.id}"]`));
});

// Enter para adicionar comentário
newCommentInput.addEventListener("keydown", e => { if(e.key === "Enter"){ e.preventDefault(); btnAddComment.click(); }});

// =============== EDIÇÃO ===============
function openLeadEdit(leadEl){
    const id = parseInt(leadEl.dataset.id);
    currentLead = leadsData.find(l => l.id === id);

    editNome.value = currentLead.nome;
    editEmail.value = currentLead.email;
    editTelefone.value = currentLead.telefone;
    editMsg.value = currentLead.mensagem;
    editStatus.value = currentLead.status;

    openModal(modalEditar);
}

formEditar.addEventListener("submit", e => {
    e.preventDefault();
    Object.assign(currentLead, {
        nome: editNome.value,
        email: editEmail.value,
        telefone: editTelefone.value,
        mensagem: editMsg.value,
        status: editStatus.value
    });
    closeModal(modalEditar);
    renderLeads();
});

// =============== NOVO LEAD ===============
btnNewLead.addEventListener("click", () => {
    const nome = prompt("Digite o nome do novo lead:");
    if(!nome) return;

    const newLead = {
        id: Date.now(),
        nome,
        email: "email@exemplo.com",
        telefone: "(00) 00000-0000",
        mensagem: "Mensagem de exemplo",
        status: "novo",
        comments: []
    };
    leadsData.unshift(newLead);
    currentPage = 1;
    renderLeads();
});

// =============== EXCLUIR SELECIONADOS ===============
btnDeleteSelected.addEventListener("click", () => {
    const checkedIds = Array.from(document.querySelectorAll(".lead-select:checked"))
        .map(cb => parseInt(cb.closest(".lead-note").dataset.id));

    if(!checkedIds.length) return alert("Nenhum lead selecionado.");
    if(!confirm(`Deseja excluir ${checkedIds.length} lead(s) selecionado(s)?`)) return;

    leadsData = leadsData.filter(l => !checkedIds.includes(l.id));
    renderLeads();
});

// =============== EXPORTAR JSON ===============
btnExport.addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(leadsData, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "leads.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    alert("Arquivo leads.json gerado (download).");
});

// =============== CARREGAR LEADS INICIALMENTE ===============
async function carregarLeads() {
    try {
        // Pode substituir por /api/leads para buscar da API
        const res = await fetch("/leads.json"); 
        leadsData = await res.json();
        renderLeads();
    } catch(err) {
        console.error("Erro ao carregar leads:", err);
        leadsData = []; 
    }
}
document.addEventListener("DOMContentLoaded", carregarLeads);

statusSelect.addEventListener("change", () => {
  const selectedStatus = statusSelect.value; // novo, contato, proposta, fechado

  document.querySelectorAll(".lead-note").forEach(lead => {
    const leadStatus = lead.querySelector(".status").classList;
    if (selectedStatus === "" || leadStatus.contains(`status-${selectedStatus}`)) {
      lead.style.display = "flex";
    } else {
      lead.style.display = "none";
    }
  });
});
</script>

</body>
</html>







